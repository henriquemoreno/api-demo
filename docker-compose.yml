services:
  apidemo-blue:
    image: ghcr.io/henriquemoreno/apidemo:${IMAGE_TAG}
    environment:
      - APP_SLOT=blue
      - APP_VERSION=${IMAGE_TAG}

  apidemo-green:
    image: ghcr.io/henriquemoreno/apidemo:${IMAGE_TAG}
    environment:
      - APP_SLOT=green
      - APP_VERSION=${IMAGE_TAG}

nginx:
  image: nginx:alpine
  ports:
    - "8080:80"
  environment:
    - ACTIVE_SLOT=${ACTIVE_SLOT}
    - CANARY_SLOT=${CANARY_SLOT}
    - CANARY_PERCENT=${CANARY_PERCENT}
  volumes:
    - ./infra/nginx/nginx.conf:/etc/nginx/conf.d/default.conf:ro
  depends_on:
    - apidemo-blue
    - apidemo-green

